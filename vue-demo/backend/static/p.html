<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/css/swiper.min.css" rel="stylesheet">
    <title>h5页面预览</title>
    <style lang="css">
        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            background: #383838;
        }

        #box {
            background: #fff;
            width: 360px;
            height: 640px;
            border: 1px solid gainsboro;
            margin: auto;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            overflow: hidden;
        }

        .page {
            position: relative;
            width: 360px;
            height: 640px;
            background: #fff;
        }

        .target {
            position: absolute;
            word-break: break-word;
        }

        .target>section,
        .target img,
        .target>video {
            object-fit: fill;
            width: 100%;
            height: 100%;
        }

        .target .el-carousel,
        .target .el-carousel__container {
            height: 100%;
        }
    </style>
</head>

<body>
     <div id="app">
        <div><audio :src="music.url" autoplay loop></audio>
            <div id="box">
                <swiper :options="swiperOption">
                    <swiper-slide v-for='page in pages' :key='page.pageId'>
                        <page :page='page' :page-bg-Color='page.props.backgroundColor' :key="page.pageId"></page>
                    </swiper-slide>
                </swiper>
        </div>
            </div>
     </div> 
    <script type="text/x-template" id='myTemplate'>        
            <div class='page' :style='{backgroundColor:pageBgColor}' >
                     <div class="target"  
                     :style="target.props|formatStyle"  
                      v-for='target in targets' 
                     :key='target.targetId'  
                     >                  
                        <el-carousel v-if="target.tag==='banner'" indicator-position='none' :interval="4000" arrow="never">
                            <el-carousel-item v-for="url in target.props.images" :key="url">
                                 <img class='target-object' :src="url">
                             </el-carousel-item>
                         </el-carousel>  
                        <section  v-if="target.tag==='text'">{{target.props.content}}</section>
                        <img  v-if="target.tag==='image'" :src="target.props.url">
                        <video  v-if="target.tag==='video'" :src="target.props.url" autoplay loop></video>            
                        <svg  v-if="target.tag==='shape'" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 100" preserveAspectRatio="none meet" version="1.1">
                            <path :d="target.props.path" :fill="target.props.fill" stroke="black" stroke-width=0 />
                        </svg>
                    </div>
        </div>
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.7/js/swiper.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/vue-awesome-swiper@3.1.2/dist/vue-awesome-swiper.js'></script>
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script src="./vconsole.min.js"></script>
    <script>
         // 初始化
  var vConsole = new VConsole();
  console.log('Hello world');
    </script>
    <script>
        Vue.use(window.VueAwesomeSwiper);
        Vue.filter('formatStyle', function (style) {
            if (Object.prototype.toString.call(style) !== '[object Object]') return;
            var result = JSON.parse(JSON.stringify(style));
            result.left = result.left + 'px';
            result.top = result.top + 'px';
            result.width = result.width + 'px';
            result.height = result.height + 'px';

            result.fontSize = result.fontSize + 'px';
            result.borderWidth = result.borderWidth + 'px';
            result.lineHeight = result.lineHeight + 'px';
            result.borderRadius = result.borderRadius + 'px';
            result.letterSpacing = result.letterSpacing + 'px';
            result['transform'] = 'rotate('+result.rotate+'deg)';
            Object.assign(result, result['animation'].animationValue);

            return result;
        })
        Vue.component('page', {
            template: '#myTemplate',
            directives: {
            },
            props: {
                page: {
                    type: Object,
                    default:function() { return {}; }
                },
                pageBgColor: {
                    type: String,
                    default: '#ffffff'
                }
            },
            computed: {
                targets:function() {
                    return this.page.targets;
                }
            },
        });
        var data={
    "pages": [
        {
            "pageId": 1529392459122,
            "targets": [
                {
                    "tag": "text",
                    "targetId": 1529392461253,
                    "pageId": 1529392459122,
                    "props": {
                        "color": "#000000",
                        "backgroundColor": "#ffd700",
                        "fontSize": 20,
                        "fontWeight": "",
                        "fontFamily": "",
                        "opacity": 1,
                        "width": 210,
                        "height": 62,
                        "left": 50,
                        "top": 50,
                        "content": "请输入文字",
                        "zIndex": 0,
                        "animation": {
                            "mode": "in",
                            "animationValue": {
                                "animationName": "slideInDown",
                                "animationDuration": "1s",
                                "animationDelay": "0s",
                                "animationIterationCount": 1,
                                "animationFillMode": "none"
                            }
                        },
                        "letterSpacing": 0,
                        "lineHeight": 20
                    }
                },
                {
                    "tag": "image",
                    "targetId": 1529392471969,
                    "pageId": 1529392459122,
                    "props": {
                        "opacity": 1,
                        "width": 320,
                        "height": 237,
                        "left": 0,
                        "top": 388,
                        "zIndex": 0,
                        "url": "http://192.168.1.131:3000/demoImage.png?82b9c",
                        "animation": {}
                    }
                }
            ],
            "props": {
                "backgroundColor": "#701414"
            }
        },
        {
            "pageId": 1529392459426,
            "targets": [
                {
                    "tag": "video",
                    "targetId": 1529392478129,
                    "pageId": 1529392459426,
                    "props": {
                        "width": 360,
                        "height": 180,
                        "left": 0,
                        "top": 120,
                        "zIndex": 0,
                        "url": "http://192.168.1.131:3000/demoVideo.mp4?bd3dd",
                        "animation": {
                            "mode": "",
                            "animationValue": {}
                        }
                    }
                },
                {
                    "tag": "shape",
                    "targetId": 1529392490921,
                    "pageId": 1529392459426,
                    "props": {
                        "width": 218,
                        "height": 233,
                        "left": 94,
                        "top": 407,
                        "zIndex": 0,
                        "path": "M92.7,45.8L100,50l-7.3,4.2l6.3,5.6l-8,2.7l5.1,6.7l-8.3,1.1l3.7,7.6l-8.4-0.6l2.2,8.1\n        l-8.1-2.2l0.6,8.4l-7.5-3.7l-1.1,8.3l-6.7-5.1l-2.7,8l-5.5-6.3l-4.2,7.3l-4.2-7.3l-5.5,6.3l-2.7-8l-6.7,5.1l-1.1-8.3l-7.5,3.7\n        l0.6-8.4l-8.1,2.2l2.2-8.1l-8.4,0.6l3.7-7.6l-8.3-1.1l5.1-6.7l-8-2.7l6.3-5.6L0,50l7.3-4.2L1,40.2l8-2.7l-5.1-6.7l8.3-1.1l-3.7-7.6\n        l8.4,0.6l-2.2-8.1l8.1,2.2l-0.6-8.4l7.5,3.7l1.1-8.4l6.7,5.1l2.7-8l5.5,6.3L50-0.1l4.2,7.3l5.5-6.3l2.7,8l6.7-5.1l1.1,8.4l7.5-3.7\n        l-0.6,8.4l8.1-2.2l-2.2,8.1l8.4-0.5l-3.7,7.6l8.3,1.1l-5.1,6.7l8,2.7L92.7,45.8L92.7,45.8z",
                        "fill": "#999999",
                        "animation": {
                            "mode": "in",
                            "animationValue": {
                                "animationName": "zoomInUp",
                                "animationDuration": "1s",
                                "animationDelay": "0s",
                                "animationIterationCount": "__vue_devtool_nan__",
                                "animationFillMode": "none"
                            }
                        }
                    }
                }
            ],
            "props": {
                "backgroundColor": "#ffffff"
            }
        },
        {
            "pageId": 1529392459697,
            "targets": [
                {
                    "tag": "banner",
                    "targetId": 1529392485760,
                    "pageId": 1529392459697,
                    "props": {
                        "width": 360,
                        "height": 337,
                        "left": 0,
                        "top": 303,
                        "zIndex": 0,
                        "images": [
                            "https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100",
                            "http://d.hiphotos.baidu.com/image/pic/item/94cad1c8a786c9171cc12b9dc53d70cf3ac75757.jpg"
                        ],
                        "interval": 5,
                        "animation": {}
                    }
                },
                {
                    "tag": "text",
                    "targetId": 1529392503459,
                    "pageId": 1529392459697,
                    "props": {
                        "color": "#9F1212",
                        "backgroundColor": "#14A977",
                        "fontSize": 20,
                        "fontWeight": "",
                        "fontFamily": "",
                        "opacity": 1,
                        "width": 200,
                        "height": 46,
                        "left": 65,
                        "top": 123,
                        "content": "请输入文字",
                        "zIndex": 0,
                        "animation": {
                            "mode": "in",
                            "animationValue": {
                                "animationName": "zoomInLeft",
                                "animationDuration": "1s",
                                "animationDelay": "0s",
                                "animationIterationCount": 1,
                                "animationFillMode": "none"
                            }
                        },
                        "letterSpacing": 0,
                        "lineHeight": 20
                    }
                }
            ],
            "props": {
                "backgroundColor": "#069216"
            }
        }
    ], 
    "bg": {
        "music": 'http://192.168.1.131:3000/demoMusic.mp3',
        "effect": "slide",
        "delay": 10
    },
    "selectedPageIndex": 2,
    "selectedTargetIndex": null,
    "editorTag": "background"
};
      

                var pages=data.pages,bg=data.bg;
                
               var vm=    new Vue({
            el: '#app',
         
            data: {
                pages:pages,
                bg:bg,
                music:bg.music||{},
                swiperOption: {
                    effect:  bg.effect||'slide',
                    speed:1000,
                    grabCursor: true,
                    autoplay: {
                        delay: bg.delay*1000||5000,
                        disableOnInteraction: false,
                        stopOnLastSlide:false
                    },
                    on: {
                         slideChange: function () {
                                var currentSilder=this.slides[this.activeIndex];
                                var currentPageVideoNodes=currentSilder.querySelectorAll('video');
                                 var allVideoNodes=document.querySelectorAll('video');//所有的video
                                 for(var v of allVideoNodes){
                                     if(Array.prototype.indexOf.call(currentPageVideoNodes,v)>-1){//当前页的视频播放
                                        v.play();
                                     }else{//其他页的视频暂停
                                         v.pause();
                                     }
                                 }
                            },
                    },
                }
            }
        });
             

    </script> 
</body>

</html>